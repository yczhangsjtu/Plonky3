//! This crate contains a framework for low-degree tests (LDTs).
#![feature(specialization)]
#![allow(incomplete_features)]
#![no_std]

mod naive;
mod fft;
mod packed;
mod packable;
mod polynomial;

pub use naive::*;

extern crate alloc;

use p3_field::{ExtensionField, Field, TwoAdicField};
use p3_matrix::dense::RowMajorMatrix;
use p3_matrix::MatrixRows;

/// Performs low-degree extensions, where both the original domain and the extended domain are
/// undefined, but must be consistent between calls with the same input height.
pub trait UndefinedLDE<Val, Dom, In>
where
    Val: Field,
    Dom: ExtensionField<Val>,
    In: for<'a> MatrixRows<'a, Val>,
{
    type Out: for<'a> MatrixRows<'a, Dom>;

    fn lde_batch(&self, polys: In, extended_height: usize) -> Self::Out;
}

/// Performs low-degree extensions over (possibly trivial) cosets of multiplicative subgroups of the
/// domain, `Dom`.
pub trait TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
    /// Given a batch of polynomials, each defined by `2^k` evaluations over the subgroup generated
    /// by `EF::primitive_root_of_unity(k)`, compute their evaluations over the (possibly trivial)
    /// coset `shift H`, where `H` is the subgroup generated by
    /// `EF::primitive_root_of_unity(k + added_bits)`.
    fn lde_batch(&self, polys: RowMajorMatrix<Val>, added_bits: usize) -> RowMajorMatrix<Dom>;
}

/// A specialization of `TwoAdicLDE` where that evaluates polynomials over a multiplicative
/// subgroup of the domain `Dom`, or in other words, a trivial coset thereof.
pub trait TwoAdicSubgroupLDE<Val, Dom>: TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
}

/// A specialization of `TwoAdicLDE` where that evaluates polynomials over a nontrivial coset of a
/// multiplicative subgroup of the domain `Dom`.
pub trait TwoAdicCosetLDE<Val, Dom>: TwoAdicLDE<Val, Dom>
where
    Val: Field,
    Dom: ExtensionField<Val> + TwoAdicField,
{
    fn shift(&self, lde_bits: usize) -> Dom;
}
